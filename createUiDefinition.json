{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "config": {
            "basics": {
                "description": "KubeSphere 是在 Kubernetes 之上构建的面向云原生应用的分布式操作系统，完全开源，支持多云与多集群管理，提供全栈的 IT 自动化运维能力，简化企业的 DevOps 工作流。它的架构可以非常方便地使第三方应用与云原生生态组件进行即插即用 (plug-and-play) 的集成。 [Learn more](https://kubesphere.com.cn/ \"Learn more\")",
                "location": {
                    "label": "区域",
                    "toolTip": "请选择适合你和你的客户的 Azure 区域。并非每个资源在每个区域都可用。",
                    "resourceTypes": [
                        "Microsoft.Compute/virtualMachines"
                    ],
                    "allowedValues": [
                        "chinaeast2",
                        "chinanorth2"
                    ],
                    "visible": true
                }
            }
        },
        "basics": [
         ],
        "steps": [
            {
                "name": "AKSsetting",
                "label": "AKS 详细设置",
                "bladeTitle": "AKS 详细设置",
                "subLabel": {
                    "preValidation": "Set AKS",
                    "postValidation": "Deploy AKS"
                },
                "elements": [
                    {
                        "name": "AKSresourceName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "AKS 服务集群名称",
                        "defaultValue": "AKS-KubeSphere",
                        "toolTip": "Azure Kubernetes 服务群集的名称。",
                        "constraints": {
                            "required": true,
                            "regex": "",
                            "validationMessage": ""
                        },
                        "visible": true
                    },
                    {
                        "name": "dnsPrefix",
                        "type": "Microsoft.Common.TextBox",
                        "label": "DNS 名称前缀",
                        "defaultValue": "AKS-KubeSphere-dns",
                        "toolTip": "与托管 Kubernetes API 服务器 FQDN 一起使用的 DNS 名称前缀。创建群集后，在管理容器时，可以使用此前缀连接到 Kubernetes API。",
                        "constraints": {
                            "required": true,
                            "regex": "",
                            "validationMessage": ""
                        },
                        "visible": true
                    },
                    {
                        "name": "kubernetesVersion",
                        "type": "Microsoft.Common.DropDown",
                        "label": "Kubernetes 版本",
                        "defaultValue": "1.20.5",
                        "toolTip": "应用于此群集的 Kubernetes 的版本。在创建群集后将能够升级此版本.",
                        "constraints": {
                            "required": true,
                            "allowedValues": [
                                {
                                    "label": "1.17.13",
                                    "value": "1.17.13"
                                },
                                {
                                    "label": "1.17.16",
                                    "value": "1.17.16"
                                },
                                {
                                    "label": "1.18.10",
                                    "value": "1.18.10"
                                },
                                {
                                    "label": "1.18.14",
                                    "value": "1.18.14"
                                },
                                {
                                    "label": "1.19.9",
                                    "value": "1.19.9"
                                },
                                {
                                    "label": "1.20.5",
                                    "value": "1.20.5"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "AKSvmSize",
                        "type": "Microsoft.Common.DropDown",
                        "label": "AKS 节点大小",
                        "defaultValue": "Standard_F8s_v2 (8核16G，对于矢量处理工作负载，最高可提升2倍的性能)",
                        "toolTip": "将在群集中组成节点的虚拟机的大小。创建群集后不能更改此大小。",
                        "constraints": {
                            "required": true,
                            "allowedValues": [
                                {
                                    "label": "Standard_D2_V3 (2核8G，非高级存储)",
                                    "value": "Standard_D2_V3"
                                },
                                {
                                    "label": "Standard_D4s_v3 (4核16G，用于常规用途)",
                                    "value": "Standard_D4s_v3"
                                },
                                {
                                    "label": "Standard_D8s_v3 (8核32G，用于常规用途)",
                                    "value": "Standard_D8s_v3"
                                },
                                {
                                    "label": "Standard_D16s_v3 (16核64G，用于常规用途)",
                                    "value": "Standard_D16s_v3"
                                },
                                {
                                    "label": "Standard_A4_v2 (4核8G，适合入门级工作负载)",
                                    "value": "Standard_A4_v2"
                                },
                                {
                                    "label": "Standard_A8_v2 (8核16G，适合入门级工作负载)",
                                    "value": "Standard_A8_v2"
                                },
                                {
                                    "label": "Standard_F4s_v2 (4核8G，对于矢量处理工作负载，最高可提升2倍的性能)",
                                    "value": "Standard_F4s_v2"
                                },
                                {
                                    "label": "Standard_F8s_v2 (8核16G，对于矢量处理工作负载，最高可提升2倍的性能)",
                                    "value": "Standard_F8s_v2"
                                },
                                {
                                    "label": "Standard_F16s_v2 (16核32G，对于矢量处理工作负载，最高可提升2倍的性能)",
                                    "value": "Standard_F16s_v2"
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "MasterNodeCount",
                        "type": "Microsoft.Common.DropDown",
                        "label": "System 节点数",
                        "defaultValue": "3",
                        "toolTip": "和节点一起创建的 System 节点数，你可以在集群创建后调整节点数。",
                        "constraints": {
                            "required": true,
                            "allowedValues": [
                                {
                                    "label": "1",
                                    "value": 1
                                },
                                {
                                    "label": "2",
                                    "value": 2
                                },
                                {
                                    "label": "3",
                                    "value": 3
                                },
                                {
                                    "label": "4",
                                    "value": 4
                                },
                                {
                                    "label": "5",
                                    "value": 5
                                }
                            ]
                        },
                        "visible": true
                    },
                    {
                        "name": "WorkerNodeCount",
                        "type": "Microsoft.Common.DropDown",
                        "label": "User 节点数",
                        "defaultValue": "3",
                        "toolTip": "和节点一起创建的 User 节点数，你可以在集群创建后调整节点数。",
                        "constraints": {
                            "required": true,
                            "allowedValues": [
                                {
                                    "label": "1",
                                    "value": 1
                                },
                                {
                                    "label": "2",
                                    "value": 2
                                },
                                {
                                    "label": "3",
                                    "value": 3
                                },
                                {
                                    "label": "4",
                                    "value": 4
                                },
                                {
                                    "label": "5",
                                    "value": 5
                                },
                                {
                                    "label": "6",
                                    "value": 6
                                },
                                {
                                    "label": "7",
                                    "value": 7
                                },
                                {
                                    "label": "8",
                                    "value": 8
                                },
                                {
                                    "label": "9",
                                    "value": 9
                                }
                            ]
                        },
                        "visible": true
                    }
                ]
            },
            {
                "name": "ClientNodesetting",
                "label": "客户端节点设置",
                "bladeTitle": "客户端节点设置",
                "subLabel": {
                    "preValidation": "Set client node",
                    "postValidation": "Deploy client node"
                },
                "elements": [
                    {
                        "name": "vmName",
                        "type": "Microsoft.Common.TextBox",
                        "label": "客户端节点名称",
                        "defaultValue": "KS-client",
                        "toolTip": "客户端节点名称，用于管理 AKS 集群，创建后不可修改虚拟机名称，但可登陆虚拟机更改主机名。",
                        "constraints": {
                            "required": true,
                            "regex": "^[a-z0-9A-Z-*/+.~!@#$%^&*()]{3,30}$",
                            "validationMessage": ""
                        },
                        "visible": true
                    },
                    {
                        "name": "adminUsername",
                        "type": "Microsoft.Common.TextBox",
                        "label": "管理员用户名",
                        "defaultValue": "",
                        "toolTip": "Username for the Virtual Machine.",
                        "constraints": {
                            "required": true,
                            "regex": "",
                            "validationMessage": ""
                        },
                        "visible": true
                    },
                    {
                      "name": "authenticationType",
                      "type": "Microsoft.Compute.CredentialsCombo",
                      "label": {
                        "authenticationType": "认证方式",
                        "password": "管理员用户密码",
                        "confirmPassword": "确认管理员用户密码",
                        "sshPublicKey": "管理员用户 ssh 公钥"
                      },
                      "toolTip": {
                        "authenticationType": "客户端节点认证方式，默认为密码认证。创建完成后可以在 Azure 管理页面上重置密码。",
                        "password": "客户端节点密码",
                        "sshPublicKey": "客户端节点公共密钥"
                      },
                      "constraints": {
                        "required": true,
                        "customPasswordRegex": "^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d-*/+.~!@#$%^&*()]{12,}$",
                        "customValidationMessage": "密码必须是字母数字，至少包含12个字符，并且至少有1个字母和1个数字,可含有部分特殊字符。"
                      },
                      "options": {
                        "hideConfirmation": false,
                        "hidePassword": false
                      },
                      "osPlatform": "Linux",
                      "visible": true
                    },
                    {
                        "name": "vmSize",
                        "type": "Microsoft.Common.DropDown",
                        "label": "客户端虚拟机节点大小",
                        "defaultValue": "Standard_D2_V3 (2核8G，非高级存储)",
                        "toolTip": "客户端虚拟机的大小。创建群集后不能更改此大小。",
                        "constraints": {
                            "required": true,
                            "allowedValues": [
                                {
                                    "label": "Standard_D2_V3 (2核8G，非高级存储)",
                                    "value": "Standard_D2_V3"
                                },
                                {
                                    "label": "Standard_D4s_v3 (4核16G，用于常规用途)",
                                    "value": "Standard_D4s_v3"
                                },
                                {
                                    "label": "Standard_D8s_v3 (8核32G，用于常规用途)",
                                    "value": "Standard_D8s_v3"
                                },
                                {
                                    "label": "Standard_D16s_v3 (16核64G，用于常规用途)",
                                    "value": "Standard_D16s_v3"
                                },
                                {
                                    "label": "Standard_A4_v2 (4核8G，适合入门级工作负载)",
                                    "value": "Standard_A4_v2"
                                },
                                {
                                    "label": "Standard_A8_v2 (8核16G，适合入门级工作负载)",
                                    "value": "Standard_A8_v2"
                                },
                                {
                                    "label": "Standard_F4s_v2 (4核8G，对于矢量处理工作负载，最高可提升2倍的性能)",
                                    "value": "Standard_F4s_v2"
                                },
                                {
                                    "label": "Standard_F8s_v2 (8核16G，对于矢量处理工作负载，最高可提升2倍的性能)",
                                    "value": "Standard_F8s_v2"
                                },
                                {
                                    "label": "Standard_F16s_v2 (16核32G，对于矢量处理工作负载，最高可提升2倍的性能)",
                                    "value": "Standard_F16s_v2"
                                }
                            ]
                        },
                        "visible": true
                    }
                ]
            }
         ],
        "outputs": { 
            "AKSresourceName": "[steps('AKSsetting').AKSresourceName]",
            "dnsPrefix": "[steps('AKSsetting').dnsPrefix]",
            "kubernetesVersion": "[steps('AKSsetting').kubernetesVersion]",
            "AKSvmSize": "[steps('AKSsetting').AKSvmSize]",
            "MasterNodeCount": "[steps('AKSsetting').MasterNodeCount]",
            "WorkerNodeCount": "[steps('AKSsetting').WorkerNodeCount]",
            "vmName": "[steps('ClientNodesetting').vmName]",
            "adminUsername": "[steps('ClientNodesetting').adminUsername]",
            "authenticationType": "[steps('ClientNodesetting').authenticationType.authenticationType]",
            "adminPassword": "[steps('ClientNodesetting').authenticationType.password]",
            "sshPublicKey": "[steps('ClientNodesetting').authenticationType.sshPublicKey]",
            "vmSize": "[steps('ClientNodesetting').vmSize]"
        }
    }
}